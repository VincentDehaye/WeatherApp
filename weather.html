<html>
<head>
</head>
<body ng-app="myApp" ng-controller="testCtrl">
<h1>
{{helloMessage}}</h1>

Select your language : 
<select ng-model="language" >
<option value="en">English</option>
<option value="ru">Russian</option>
<option value="it">Italian</option>
<option value="uk">Ukrainian</option>
<option value="de">German</option>
<option value="pt">Portuguese</option>
<option value="ro">Romanian</option>
<option value="pl">Polish</option>
<option value="fi">Finnish</option>
<option value="nl">Dutch</option>
<option value="fr">French</option>
<option value="bg">Bulgarian</option>
<option value="sv">Swedish</option>
<option value="zh_tw">Chinese Traditional</option>
<option value="zh">Chinese Simplified</option>
<option value="tr">Turkish</option>
<option value="hr">Croatian</option>
<option value="ca">Catalan</option>
</select>

<br>
Select your units format : 
<select ng-model="format" >
<option value="metric">Metric</option>
<option value="imperial">Imperial</option>
</select>
<br>

<select ng-model="forecast" >
<option value="1">One day</option>
<option value="3">Three days</option>
<option value="5">Five days</option>
</select> forecast
<br>

Format : [city name] OR [city name,country code] OR [latitude;longitude]
  <input type="text" 
         ng-model="search" 
		 ng-model-options="{debounce : 1000}"
         placeholder="Enter city name" />

  



{{search}}

<div ng-if="response.Response!=='False'">
  Related Results:<hr>
  <h1>Current weather : </h1>
  <ul class="rel-results">
    <li ng-repeat="city in res1">
       {{city}}
    </li>
  </ul>
  <br><br>
  <h1>Forecast weather : </h1>
  <ul class="rel-results">
    <li ng-repeat="city in res2">
       {{city}}
    </li>
  </ul>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"> </script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-cookies.js"> </script>
<script type="text/javascript">
var myApp = angular.module('myApp',['ngCookies']);

myApp.controller('testCtrl',['$scope','$http','$cookies', function($scope,$http,$cookies) {
	$scope.helloMessage="Hello World";
	$scope.language="en";
	$scope.format="metric";
	$scope.forecast="1";
	$scope.key = "a22ea50f7ac900659eb83725cf4a6d4e";
	var now = new Date(), exp = new Date(now.getFullYear(), now.getMonth()+1, now.getDate());
	$scope.search=$cookies.get('Location');
	$scope.$watch('search', function() {
		$scope.fetch();
	});
	
	$scope.$watch('language', function() {
		$scope.fetch();
	});
	
	$scope.$watch('format', function() {
		$scope.fetch();
	});
	
	$scope.fetch = function(){
		if ($scope.search!=null && $scope.search!="") 
		{   $cookies.put('Location',$scope.search,{ expires : exp});
			$scope.urlCurrent = "http://api.openweathermap.org/data/2.5/weather?";
			$scope.urlForecast = "http://api.openweathermap.org/data/2.5/forecast?";
			var firstChar = $scope.search.substring(0, 1);
			if (isNaN(firstChar)) {
				$scope.urlTemp = "q=" + $scope.search;
			}
			else {
				var num = $scope.search.indexOf(';');
				$scope.lat = $scope.search.substring(0,num);
				//The only problem occurring with spaces is when it's placed right after the ;, so to prevent that we delete these ones : 
				while ($scope.search.charAt(num+1)==" ") {$scope.search = $scope.lat + ";" + $scope.search.substring(num+2);}
				$scope.lon = $scope.search.substring(num+1);
				$scope.urlTemp = "lat=" + $scope.lat + "&lon=" + $scope.lon;
			}
			$scope.urlTemp +=  "&APPID=" + $scope.key + "&lang=" + $scope.language + "&units=" + $scope.format;
			$scope.urlCurrent += $scope.urlTemp;
			$scope.urlForecast += $scope.urlTemp;
			
			$http.get($scope.urlCurrent)
			.then(function(response){ $scope.res1 = response.data;
			$scope.status1= response.status;},
			function errorCallback(response) {
				alert(response.status);
			});
			
			$http.get($scope.urlForecast)
			.then(function(response){ $scope.res2 = response.data;
			$scope.status2= response.status;},
			function errorCallback(response) {
				alert(response.status);
			});
			
		}
	}
}]);
</script>
</body>
</html>