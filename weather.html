<html>
<head>
</head>
<body ng-app="myApp" ng-controller="testCtrl">
<h1>
{{helloMessage}}</h1>

Select your language : 
<select ng-model="language" >
<option value="en">English</option>
<option value="ru">Russian</option>
<option value="it">Italian</option>
<option value="uk">Ukrainian</option>
<option value="de">German</option>
<option value="pt">Portuguese</option>
<option value="ro">Romanian</option>
<option value="pl">Polish</option>
<option value="fi">Finnish</option>
<option value="nl">Dutch</option>
<option value="fr">French</option>
<option value="bg">Bulgarian</option>
<option value="sv">Swedish</option>
<option value="zh_tw">Chinese Traditional</option>
<option value="zh">Chinese Simplified</option>
<option value="tr">Turkish</option>
<option value="hr">Croatian</option>
<option value="ca">Catalan</option>
</select>
<br>
Select your units format : 
<select ng-model="format" >
<option value="metric">Metric</option>
<option value="imperial">Imperial</option>
</select>
<br>
<div class="input-group search-bar">
  <input type="text" 
         ng-model="search" 
		 ng-model-options="{debounce : 1000}"
         placeholder="Enter city name" />

  
</div>


{{search}}

<div ng-if="response.Response!=='False'">
  Related Results:<hr>

  <ul class="rel-results">
    <li ng-repeat="city in res">
       {{city}}
    </li>
  </ul>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"> </script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-cookies.js">//Antoine </script>
<script type="text/javascript">
var myApp = angular.module('myApp',['ngCookies']);

myApp.controller('testCtrl',['$scope','$http','$cookies', function($scope,$http,$cookies) {//Antoine
	$scope.helloMessage="Hello World";
	$scope.language="en";
	$scope.format="metric";
	$scope.key = "a22ea50f7ac900659eb83725cf4a6d4e";
	var now = new Date(), exp = new Date(now.getFullYear(), now.getMonth()+1, now.getDate());
	$scope.search=$cookies.get('Location');//Antoine (je gere le fait qu'il soit vide plus loin)
	$scope.$watch('search', function() {
		$scope.fetch();
	});
	
	$scope.$watch('language', function() {
		$scope.fetch();
	});
	
	$scope.$watch('format', function() {
		$scope.fetch();
	});
	
	$scope.fetch = function(){
		$scope.url= "http://api.openweathermap.org/data/2.5/weather?q=" + $scope.search + "&APPID=" + $scope.key + "&lang=" + $scope.language + "&units=" + $scope.format;
		if ($scope.search!=null && $scope.search!="") 
			
			{$cookies.put('Location',$scope.search,{ expires : exp});//Antoine : ici je donne la valeur de la recherche au cookie avant de faire la requete
				$http.get($scope.url)
				.then(function(response){ $scope.res = response.data;
				$scope.status= response.status;},
				function errorCallback(response) {
					alert(response.status);
				});
			}
	}
}]);
</script>
</body>
</html>